"""
API Routes for {{ provider }}/{{ resource_type }}
Generated: {{ timestamp }}
"""

from flask import Blueprint, request, jsonify
from mazure.core.state import StateManager
from mazure.services.{{ service_package }}.{{ resource_type.lower() }} import {{ resource_type | title | replace('_', '') }}Service
import asyncio

bp = Blueprint('{{ provider.lower().replace('.', '_') }}_{{ resource_type.lower() }}', __name__)
state = StateManager()
service = {{ resource_type | title | replace('_', '') }}Service(state)

def run_async(coro):
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    try:
        return loop.run_until_complete(coro)
    finally:
        loop.close()

{% for op in operations %}
# Operation: {{ op.operation_id }}
# Path: {{ op.path }}
@bp.route('{{ op.path | replace("{", "<") | replace("}", ">") }}', methods=['{{ op.method }}'])
def {{ op.operation_id | lower | replace('.', '_') | replace('-', '_') }}(**kwargs):
    # This is a stub implementation
    # Arguments from path are in kwargs

    # We would need to map kwargs to service arguments here
    # subscriptionId -> subscription_id
    # resourceGroupName -> resource_group

    # Example of how to call the async service:
    # try:
    #     result = run_async(service.{{ op.operation_id | lower | replace('.', '_') | replace('-', '_') }}(
    #         subscription_id=kwargs.get('subscriptionId'),
    #         resource_group=kwargs.get('resourceGroupName'),
    #         resource_name=kwargs.get('resourceName'),
    #         parameters=request.get_json(silent=True) or {},
    #         **kwargs
    #     ))
    #     return jsonify(result)
    # except NotImplementedError:
    #     return jsonify({"error": "Not implemented"}), 501
    # except Exception as e:
    #     return jsonify({"error": str(e)}), 500

    return jsonify({"message": "Generated route for {{ op.operation_id }}", "path_params": kwargs}), 501
{% endfor %}
